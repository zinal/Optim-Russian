# Генератор справочников и примера данных для маскирования

Проект ru-dict-maker содержит исходный код генератора справочников ФИО
и генератора примера данных для маскирования. Двоичная сборка инструмента
доступна на [странице релизов](https://github.com/zinal/Optim-Russian/releases).

## Использование генератора справочников ФИО

Генератор справочников ФИО принимает на вход текстовые файлы с перечнями имён
и фамилий, и обеспечивает псевдослучайное комбинирование входных данных для
получения нужного количества комбинаций значений Фамилия, Имя, Отчество
для лиц мужского и женского пола. Результат генерации сохраняется в базе
данных (проверялась работа с базами данных Db2 и H2).

Структура таблиц базы данных описана в файле `optimdemo-dicts.sql`.
Основными выходными таблицами являются:
- `dict_fio` - полный справочник значений ФИО;
- `dict_fio_male` - справочник значений ФИО для лиц мужского пола;
- `dict_fio_female` - справочник значений ФИО для лиц женского пола.

В каждом справочнике присутствует числовое поле ID, которое может использоваться
как ключ для подстановки (является первичным ключом таблицы).

Генератор справочников ФИО настраивается конфигурационным файлом `dict-maker.xml`.
Пример содержимого файла (файл `dict-maker.xml.templ` в двоичном дистрибутиве):

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
<comment>Job file for dictionary builder</comment>
<entry key="NamesMale">dict/names_m.txt</entry>
<entry key="NamesFemale">dict/names_f.txt</entry>
<entry key="FamMale">dict/fam_m.txt</entry>
<entry key="FamFemale">dict/fam_f.txt</entry>
<entry key="SaltKey">qazwsx</entry>
<entry key="TotalNames">10000</entry>
<!-- DbName means H2 database output. 
     DbUrl, DbUser and DbPassword need to be specified otherwise. -->
<!-- <entry key="DbName">./dict-names</entry> -->
<entry key="DbUrl">jdbc:db2://publicocp:31715/BLUDB</entry>
<entry key="DbUser">mzinal</entry>
<entry key="DbPassword">passw0rd$</entry>
<!-- <entry key="TableAction">CREATE</entry> -->
<entry key="TableAction">TRUNCATE</entry>
</properties>
```

Для запуска процедуры генерации данных используется скрипт `run-dict-maker.sh`
(на платформе Windows - `run-dict-maker.cmd`). Требуется наличие установленной
виртуальной машины Java, желательно в 64-битном варианте.

Ниже приведено описание параметров, влияющих на генерацию справочника.

Параметры `NamesMale`, `NamesFemale`, `FamMale`, `FamFemale` задают имена файлов,
содержащих исходные данные для генерации, включая:
- список мужских имён, включая форматы отчества для мужского и женского пола;
- список женских имён;
- список мужских фамилий;
- список женских фамилий.

Стандартный вариант наполнения списков имён и фамилий размещён в подкаталоге
`dict` двоичного дистрибутива, а также в каталоге
[ru-dict-data](https://github.com/zinal/Optim-Russian/tree/main/ru-dict-data)
репозитория Git.

Изменение параметра `SaltKey` позволяет поменять последовательность обработки
исходных списков имён и фамилий, тем самым обеспечивая генерацию различного
наполнения для справочника ФИО.

Параметр `TotalNames` устанавливает количество генерируемых уникальных
комбинаций ФИО (используется одинаковое значение для генерации ФИО
лиц мужского и женского пола). Количество генерируемых комбинаций ограничено
доступными исходными данными (размерами списков имён и фамилий).

Необходимо учитывать, что логика формирования комбинаций расчитана на случай,
когда требуемое количество генерируемых значений как минимум в 2-3 раза меньше
теоретически возможного количества комбинаций, определяемого как произведение
следующих величин:
- размер списка имён для мужского пола (количество возможных отчеств);
- размер списка женских фамилий;
- размер списка женских имён.

В случае установки параметра `TotalNames` в чрезмерно большое значение
генерация справочника будет прервана с ошибкой. Стандартное наполнение
списков имён обеспечивает эффективную генерацию не менее 100 млн. значений
(суммарно 200 млн. значений для ФИО лиц мужского и женского пола).

Если установлен параметр `DbName`, то результат генерации справочника сохраняется
в файловую базу данных H2, имя файла которой соответствует значению параметра.
Режим работы с базой данных H2 зависит от значения параметра `TableAction`:
- `CREATE` - существующая БД удаляется, создаётся новая, в новой БД создаются
  новые таблицы справочника, которые заполняются данными;
- `TRUNCATE` - открывается существующая БД (должна существовать перед запуском),
  существующие таблицы справочника очищаются и заполняются новыми данными.

Если параметр `DbName` не установлен, результат генерации сохраняется в базе
данных, параметры подключения к которой определяются параметрами:
- `DbUrl` - JDBC URL для подключения к БД;
- `DbUser` - логин для подключения к БД;
- `DbPassword` - пароль для подключения к БД.

Протестирована возможность сохранения справочников в базу данных Db2.
Режим работы с таблицами зависит от значения параметра `TableAction`:
- `CREATE` - создаются новые таблицы справочника (таблицы не должны существовать),
  которые заполняются данными;
- `TRUNCATE` - существующие таблицы справочника очищаются и заполняются новыми данными.


## Использование генератора примера данных для маскирования

Генератор примера данных для маскирования обеспечивает автоматическое заполнение
данными структуры таблиц, описанной в файле `optimdemo-schema.sql`. Используемая
структура данных имитирует ведение информации о контактах клиентов, являющихся
физическими и юридическими лицами.

Поддерживается заполнение баз данных PostgreSQL и Db2. Необходимая структура таблиц
должна быть предварительно создана.

Поддерживается инкрементальная работы генератора, позволяющая дополнить ранее
сгенерированный набор данных новой порцией информации. Для этого достаточно
повторно запустить генератор, указав параметры подключения к ранее заполненной
базе данных. За одну итерацию генератор обеспечивает формирование данных
для 5000 юридических и 50000 физических лиц.

Параметры работы генератора настраиваются в файле `data-sample.properties`.
Пример файла настроек поставляется в виде файла `data-sample.properties.templ`:

```properties
DbUrl = jdbc:postgresql://host:5432/dbname
DbUser = username
DbPassword = password
NamesMale = dict/names_m.txt
NamesFemale = dict/names_f.txt
FamMale = dict/fam_m.txt
FamFemale = dict/fam_f.txt
Flowers = dict/flowers.txt
SaltKey = iddqd1995
```

Для запуска процедуры генерации данных используется скрипт `run-data-sample.sh`
(на платформе Windows - `run-data-sample.cmd`). Требуется наличие установленной
виртуальной машины Java, желательно в 64-битном варианте.

Ниже приведено описание параметров, влияющих на генерацию примера данных.

Параметры `NamesMale`, `NamesFemale`, `FamMale`, `FamFemale`, `Flowers` задают
имена файлов, содержащих исходные данные для генерации, включая:
- список мужских имён, включая форматы отчества для мужского и женского пола;
- список женских имён;
- список мужских фамилий;
- список женских фамилий;
- список названий комнатных растений
  (используется для генерации названий организаций).

Изменение параметра `SaltKey` меняет последовательность обработки справочников
и позволяет изменить генерируемый набор данных.
